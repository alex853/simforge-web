<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>airways / VATSIM Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="js/requests.js"></script>
</head>
<body>
<div class="container my-5">
    <h2 class="mb-4">VATSIM Tracker</h2>
    <div class="mb-3">
        <div class="btn-group" role="group" aria-label="Filter status">
            <button type="button" class="btn btn-outline-primary filter-btn active" data-filter="everything">Everything</button>
            <button type="button" class="btn btn-outline-primary filter-btn" data-filter="all-good-only">AllGood only</button>
        </div>
    </div>
    <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover">
            <thead class="table-dark">
            <tr>
                <th>Pilot #</th>
                <th>Flight Stage</th>
                <th>Planning Status</th>
                <th>Overall Status</th>
                <th>Location</th>
                <th>A/C Type</th>
                <th>Reg No</th>
                <th>FP Dep</th>
                <th>FP Dest</th>
                <th>L/T/D</th>
                <th>Removal</th>
                <th>F/M Id</th>
                <th>F/M Status</th>
                <th>F/M Reg No</th>
            </tr>
            </thead>
            <tbody id="table-body">
            <!-- Rows will be inserted here -->
            </tbody>
        </table>
    </div>
</div>

<script>

    let data = [];
    let currentFilter = 'everything';

    function showAircraftTable() {
        const $tbody = $('#table-body');
        $tbody.empty();

        const filteredData = data.filter(item => {
            if (currentFilter === 'everything') return true;
            return item.overallStatus === 'AllGood';
        });

        filteredData.forEach(item => {
            const row = `
          <tr>
            <td>${item.pilotNumber}</td>
            <td>${item.flightStage}</td>
            <td>${item.planningStatus}</td>
            <td>${item.overallStatus}</td>
            <td>${item.locationIcao ?? ''}</td>
            <td>${item.aircraftType ?? ''}</td>
            <td>${item.regNo ?? ''}</td>
            <td>${item.departureIcao ?? ''}</td>
            <td>${item.destinationIcao ?? ''}</td>
            <td>${item.lastTrackedDistance}</td>
            <td>${item.removal}</td>
            <td>${item.fmId}</td>
            <td>${item.fmStatus ?? ''}</td>
            <td>${item.fmAircraftRegNo ?? ''}</td>
          </tr>`;
            $tbody.append(row);
        })
    }

    function reloadData() {
        airwaysGet("/vatsim-tracker/all", function (response) {
            data = response;
            showAircraftTable();
        });
    }

    $(document).ready(function () {
        $('.filter-btn').on('click', function () {
            $('.filter-btn').removeClass('active');
            $(this).addClass('active');
            currentFilter = $(this).data('filter');
            showAircraftTable();
        });

        reloadData();

        setInterval(() => reloadData(), 30000);
    });

</script>
</body>
</html>