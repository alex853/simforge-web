<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>airways / Journeys</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="js/requests.js"></script>

    <style>
        .btn-xsm {
            padding: .15rem .35rem;
            font-size: .725rem;
            line-height: 1.5;
            border-radius: .2rem
        }
        .font-xsm {
            font-size: .725rem;
        }
    </style>

</head>
<body>
<div class="container my-5">
    <h2 class="mb-4">Journeys</h2>
    <!--div class="mb-3">
        <div class="btn-group" role="group" aria-label="Filter status">
            <button type="button" class="btn btn-outline-primary filter-btn active" data-filter="all">All</button>
            <button type="button" class="btn btn-outline-primary filter-btn" data-filter="actual">Actual</button>
        </div>
    <div-->
    <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover">
            <colgroup>
                <col>
                <col>
                <col>
                <col style="width: 8%;">
                <col style="width: 8%;">
                <col style="width: 5%;">
                <col>
                <col>
                <!--col style="width: 6%;">
                <col style="width: 6%;"-->
                <col style="width: 7%;">
            </colgroup>
            <thead class="table-dark">
            <tr>
                <th rowspan="2" class="text-center align-middle">ID</th>
                <th rowspan="2" class="text-center align-middle">Heartbeat</th>
                <th rowspan="2" class="text-center align-middle">Status</th>
                <th colspan="2" class="text-center align-middle">Route</th>
                <th rowspan="2" class="text-center align-middle">PAX</th>
                <th colspan="2" class="text-center align-middle">T/F 1 ID</th>
                <th rowspan="2" class="text-center align-middle">Actions</th>
            </tr>
            <tr>
                <th class="text-center align-middle">From</th>
                <th class="text-center align-middle">To</th>
                <th class="text-center align-middle">ID</th>
                <th class="text-center align-middle">Status</th>
                <!--th class="text-center align-middle">Dep</th>
                <th class="text-center align-middle">Arr</th>
                <!--th class="text-center align-middle">Total</th>
                <th class="text-center align-middle">Rem-d</th>
                <th class="text-center align-middle">Ckd In</th>
                <th class="text-center align-middle">On Brd</th-->
            </tr>
            </thead>
            <tbody id="table-body">
            <!-- Rows will be inserted here -->
            </tbody>
        </table>
    </div>
</div>

<script>

    let currentFilter = 'all'; // Default
    let dataIsLoadingNow = false;

    // Update active filter button
/*    $('.filter-btn').on('click', function () {
        $('.filter-btn').removeClass('active');
        $(this).addClass('active');
        currentFilter = $(this).data('filter');
        reloadData(); // Reload data using new filter
    });*/

    function updateTableData(data) {
        const $tbody = $('#table-body');
        $tbody.empty();
        data.forEach(item => {
            const row = `
          <tr>
            <td class="text-center align-middle">${item.id}</td>
            <td class="text-center align-middle">${item.hrtBt ?? ''}</td>
            <td class="text-center align-middle">${item.st}</td>
            <td class="text-center align-middle">${item.fcn}</td>
            <td class="text-center align-middle">${item.tcn}</td>
            <td class="text-center align-middle">${item.gs}</td>
            <td class="text-center align-middle">${item.tf1Id ?? ''}</td>
            <td class="text-center align-middle font-xsm">${ item.tf1Id 
                                                            ? `${item.tf1St}<br>${item.tf1From} - ${item.tf1To}`
                                                            : '' }</td>
            <!--td class="text-center align-middle">${item.tf1From ?? ''}</td>
            <td class="text-center align-middle">${item.tf1To ?? ''}</td-->
            <td class="text-center align-middle">
                <!--button type="button" class="btn btn-outline-warning btn-xsm" onclick="adminCancel(${item.id})">C</button>
                <button type="button" class="btn btn-outline-danger btn-xsm" onclick="adminRemove(${item.id})">R</button-->
            </td>
          </tr>`;
            $tbody.append(row);
        })
    }

    function reloadData() {
        if (dataIsLoadingNow) {
            return;
        }
        dataIsLoadingNow = true;
        airwaysGet('/journey/' + currentFilter, function (response) {
            dataIsLoadingNow = false;
            updateTableData(response);
        }, function () {
            dataIsLoadingNow = false;
        });
    }

    $(document).ready(function () {
        reloadData();

        setInterval(() => reloadData(), 10000);
    });

/*    function adminCancel(id) {
        if (!confirm("Do you want to cancel this flight?")) return;
        airwaysGetPlain('/admin/transport-flight/cancel?tfId=' + id, function () {
            reloadData();
        });
    }

    function adminRemove(id) {
        if (!confirm("Do you want to remove this flight?")) return;
        airwaysGetPlain('/admin/transport-flight/remove?tfId=' + id, function () {
            reloadData();
        });
    }*/

</script>
</body>
</html>
